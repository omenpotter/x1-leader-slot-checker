<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>X1 Leader Slot Checker</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #04070f;
    --surface: #0b1120;
    --border: #1a2a45;
    --accent: #00f5c4;
    --accent2: #0088ff;
    --warn: #ffaa00;
    --danger: #ff4466;
    --text: #c8deff;
    --muted: #4a6080;
    --glow: 0 0 20px rgba(0,245,196,0.25);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,245,196,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,245,196,0.03) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }

  /* Glowing orbs */
  body::after {
    content: '';
    position: fixed;
    top: -200px;
    left: -200px;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(0,136,255,0.08) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .orb2 {
    position: fixed;
    bottom: -200px;
    right: -200px;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(0,245,196,0.06) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 760px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }

  /* Header */
  header {
    text-align: center;
    margin-bottom: 48px;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(0,245,196,0.08);
    border: 1px solid rgba(0,245,196,0.2);
    border-radius: 100px;
    padding: 6px 16px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 20px;
  }

  .badge::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  h1 {
    font-size: clamp(28px, 5vw, 48px);
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -1px;
    color: #fff;
  }

  h1 span {
    color: var(--accent);
  }

  .subtitle {
    margin-top: 12px;
    font-size: 15px;
    color: var(--muted);
    font-weight: 400;
  }

  /* Card */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 20px;
    transition: border-color 0.3s;
  }

  .card:hover { border-color: rgba(0,245,196,0.2); }

  .card-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 12px;
  }

  /* Input group */
  .input-group {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  label {
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  input {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    color: #fff;
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    width: 100%;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,245,196,0.1);
  }

  input::placeholder { color: var(--muted); }

  .btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #000;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,245,196,0.3);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* Slot time meter */
  .slot-meter {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 8px;
  }

  .meter-bar {
    flex: 1;
    height: 4px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .meter-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.8s ease, background 0.5s;
  }

  /* Results grid */
  .results-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  @media (max-width: 500px) { .results-grid { grid-template-columns: 1fr; } }

  .stat-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: border-color 0.3s;
  }

  .stat-card.highlight {
    border-color: rgba(0,245,196,0.3);
    background: rgba(0,245,196,0.04);
  }

  .stat-card.full-width {
    grid-column: 1 / -1;
  }

  .stat-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .stat-value {
    font-family: 'Space Mono', monospace;
    font-size: 22px;
    font-weight: 700;
    color: #fff;
    line-height: 1.2;
  }

  .stat-value.accent { color: var(--accent); }
  .stat-value.warn { color: var(--warn); }
  .stat-value.big { font-size: 32px; }

  .stat-sub {
    font-size: 11px;
    color: var(--muted);
    margin-top: 4px;
  }

  /* Countdown */
  .countdown {
    display: flex;
    gap: 16px;
    align-items: flex-end;
    flex-wrap: wrap;
  }

  .countdown-unit {
    text-align: center;
  }

  .countdown-num {
    font-family: 'Space Mono', monospace;
    font-size: 36px;
    font-weight: 700;
    color: var(--accent);
    display: block;
    line-height: 1;
  }

  .countdown-label {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .countdown-sep {
    font-size: 28px;
    color: var(--border);
    padding-bottom: 8px;
    font-family: 'Space Mono', monospace;
  }

  /* Progress bar for epoch */
  .epoch-progress {
    margin-top: 12px;
  }

  .epoch-bar {
    height: 6px;
    background: var(--border);
    border-radius: 6px;
    overflow: hidden;
    margin-top: 8px;
  }

  .epoch-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 6px;
    transition: width 0.8s ease;
  }

  /* Status indicator */
  .status-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 13px;
    margin-bottom: 16px;
  }

  .status-row.measuring { background: rgba(255,170,0,0.08); border: 1px solid rgba(255,170,0,0.2); color: var(--warn); }
  .status-row.fetching { background: rgba(0,136,255,0.08); border: 1px solid rgba(0,136,255,0.2); color: var(--accent2); }
  .status-row.done { background: rgba(0,245,196,0.08); border: 1px solid rgba(0,245,196,0.2); color: var(--accent); }
  .status-row.error { background: rgba(255,68,102,0.08); border: 1px solid rgba(255,68,102,0.2); color: var(--danger); }

  .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .dot.spin {
    border: 2px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    width: 10px; height: 10px;
  }

  /* Log */
  .log {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.8;
    padding: 16px;
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    border: 1px solid var(--border);
    max-height: 140px;
    overflow-y: auto;
  }

  .log-line { display: flex; gap: 8px; }
  .log-time { color: rgba(0,245,196,0.4); flex-shrink: 0; }
  .log-msg { color: var(--muted); }
  .log-msg.ok { color: rgba(0,245,196,0.7); }
  .log-msg.err { color: var(--danger); }

  /* No slots message */
  .no-slots {
    text-align: center;
    padding: 32px;
  }

  .no-slots .icon { font-size: 40px; margin-bottom: 12px; }
  .no-slots h3 { color: #fff; margin-bottom: 8px; }
  .no-slots p { color: var(--muted); font-size: 14px; }

  /* Slot list preview */
  .slot-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 8px;
  }

  .slot-pill {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 4px;
    background: rgba(0,136,255,0.1);
    border: 1px solid rgba(0,136,255,0.2);
    color: var(--accent2);
  }

  .slot-pill.next {
    background: rgba(0,245,196,0.15);
    border-color: rgba(0,245,196,0.4);
    color: var(--accent);
  }

  .hidden { display: none; }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-in {
    animation: fadeIn 0.4s ease forwards;
  }

  /* Footer */
  footer {
    text-align: center;
    margin-top: 48px;
    font-size: 12px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
  }

  footer a { color: var(--accent); text-decoration: none; }
</style>
</head>
<body>
<div class="orb2"></div>
<div class="container">

  <!-- Header -->
  <header>
    <div class="badge">X1 Mainnet</div>
    <h1>Leader Slot<br/><span>Checker</span></h1>
    <p class="subtitle">Find your validator's next block production slot in real-time</p>
  </header>

  <!-- Input Card -->
  <div class="card">
    <div class="card-label">// Configuration</div>
    <div class="input-group">
      <div class="field">
        <label>Validator Identity Pubkey</label>
        <input type="text" id="pubkey"
          placeholder="e.g. Bees4UreRCWJKeDJub23QSyCej3wcybFdwv5Dem8fTWt"
          value="Bees4UreRCWJKeDJub23QSyCej3wcybFdwv5Dem8fTWt"/>
      </div>
      <div class="field">
        <label>RPC Endpoint</label>
        <input type="text" id="rpc" value="https://rpc.mainnet.x1.xyz"/>
      </div>
      <button class="btn btn-primary" id="checkBtn" onclick="runCheck()">
        Check Leader Slots
      </button>
    </div>
  </div>

  <!-- Results -->
  <div id="resultsSection" class="hidden">

    <!-- Status log -->
    <div class="card">
      <div class="card-label">// Live Log</div>
      <div id="statusRow" class="status-row fetching">
        <div class="dot spin"></div>
        <span id="statusText">Initializing...</span>
      </div>
      <div class="log" id="logBox"></div>
    </div>

    <!-- Main stats -->
    <div id="mainStats" class="hidden">
      <div class="card animate-in">
        <div class="card-label">// Slot Timing</div>
        <div class="results-grid" style="margin-bottom:16px">
          <div class="stat-card">
            <div class="stat-label">Live Slot Time</div>
            <div class="stat-value accent" id="slotMs">‚Äî</div>
            <div class="stat-sub">ms per slot (measured)</div>
            <div class="slot-meter">
              <div class="meter-bar">
                <div class="meter-fill" id="slotMeterFill" style="width:0%"></div>
              </div>
              <span id="slotQuality" style="font-size:11px;color:var(--muted)">‚Äî</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Current Slot</div>
            <div class="stat-value" id="currentSlot">‚Äî</div>
            <div class="stat-sub" id="epochInfo">Epoch ‚Äî</div>
          </div>
        </div>
        <div class="epoch-progress">
          <div class="stat-label">Epoch Progress</div>
          <div class="epoch-bar">
            <div class="epoch-fill" id="epochFill" style="width:0%"></div>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:4px">
            <span style="font-size:11px;color:var(--muted)" id="epochPct">0%</span>
            <span style="font-size:11px;color:var(--muted)" id="epochSlots">‚Äî slots remaining</span>
          </div>
        </div>
      </div>

      <!-- Next leader slot -->
      <div id="noSlotsCard" class="card hidden animate-in">
        <div class="no-slots">
          <div class="icon">‚è≥</div>
          <h3>No upcoming slots this epoch</h3>
          <p>All leader slots for this epoch have passed or none were assigned.<br/>
          The schedule rotates approximately every 2 days.</p>
        </div>
      </div>

      <div id="nextSlotCard" class="card animate-in hidden">
        <div class="card-label">// Next Leader Slot</div>
        <div class="results-grid">
          <div class="stat-card highlight full-width">
            <div class="stat-label">Time Until Next Block</div>
            <div class="countdown" id="countdown">
              <div class="countdown-unit">
                <span class="countdown-num" id="ctHours">00</span>
                <span class="countdown-label">Hours</span>
              </div>
              <span class="countdown-sep">:</span>
              <div class="countdown-unit">
                <span class="countdown-num" id="ctMins">00</span>
                <span class="countdown-label">Minutes</span>
              </div>
              <span class="countdown-sep">:</span>
              <div class="countdown-unit">
                <span class="countdown-num" id="ctSecs">00</span>
                <span class="countdown-label">Seconds</span>
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Next Slot #</div>
            <div class="stat-value accent" id="nextSlotNum">‚Äî</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Slots Remaining</div>
            <div class="stat-value" id="slotsRemaining">‚Äî</div>
          </div>
          <div class="stat-card full-width">
            <div class="stat-label">Upcoming Slots This Epoch</div>
            <div class="slot-list" id="slotList"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <footer>
    Built for X1 Mainnet &nbsp;¬∑&nbsp;
    RPC: <a href="https://rpc.mainnet.x1.xyz" target="_blank">rpc.mainnet.x1.xyz</a>
  </footer>
</div>

<script>
  const CORS_PROXY = 'https://corsproxy.io/?';

  let countdownInterval = null;
  let nextSlotAbs = null;
  let msPerSlot = 400;
  let currentSlotVal = 0;
  let checkTimestamp = 0;

  function log(msg, type='') {
    const box = document.getElementById('logBox');
    const now = new Date().toLocaleTimeString('en-US', {hour12:false});
    const line = document.createElement('div');
    line.className = 'log-line';
    line.innerHTML = `<span class="log-time">[${now}]</span><span class="log-msg ${type}">${msg}</span>`;
    box.appendChild(line);
    box.scrollTop = box.scrollHeight;
  }

  function setStatus(text, type='fetching') {
    const row = document.getElementById('statusRow');
    row.className = `status-row ${type}`;
    const dot = type === 'done' ? '<div class="dot" style="background:var(--accent)"></div>'
               : type === 'error' ? '<div class="dot" style="background:var(--danger)"></div>'
               : '<div class="dot spin"></div>';
    row.innerHTML = `${dot}<span>${text}</span>`;
  }

  async function rpcCall(rpc, method, params=[]) {
    const url = CORS_PROXY + encodeURIComponent(rpc);
    const res = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({jsonrpc:'2.0', id:1, method, params})
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    return data.result;
  }

  async function getSlot(rpc) {
    return await rpcCall(rpc, 'getSlot');
  }

  async function runCheck() {
    const pubkey = document.getElementById('pubkey').value.trim();
    const rpc = document.getElementById('rpc').value.trim();

    if (!pubkey || !rpc) { alert('Please fill in both fields.'); return; }

    // Reset
    document.getElementById('resultsSection').classList.remove('hidden');
    document.getElementById('mainStats').classList.add('hidden');
    document.getElementById('noSlotsCard').classList.add('hidden');
    document.getElementById('nextSlotCard').classList.add('hidden');
    document.getElementById('logBox').innerHTML = '';
    document.getElementById('checkBtn').disabled = true;
    if (countdownInterval) clearInterval(countdownInterval);

    setStatus('Measuring live slot time...', 'measuring');
    log('Starting slot time measurement (5s sample)...');

    try {
      // Step 1: Measure slot time
      const slot1 = await getSlot(rpc);
      const t1 = Date.now();
      log(`Slot sample 1: ${slot1.toLocaleString()}`);

      await new Promise(r => setTimeout(r, 5000));

      const slot2 = await getSlot(rpc);
      const t2 = Date.now();
      log(`Slot sample 2: ${slot2.toLocaleString()}`);

      const slotDiff = slot2 - slot1;
      const timeDiff = t2 - t1;
      msPerSlot = slotDiff > 0 ? Math.round(timeDiff / slotDiff) : 400;
      currentSlotVal = slot2;
      checkTimestamp = t2;

      log(`Measured: ${slotDiff} slots in ${timeDiff}ms ‚Üí ${msPerSlot}ms/slot`, 'ok');

      // Update slot time display
      document.getElementById('slotMs').textContent = `${msPerSlot}ms`;
      const quality = msPerSlot < 420 ? 'Fast ‚úì' : msPerSlot < 480 ? 'Normal' : 'Slow';
      const fillPct = Math.min(100, Math.max(0, ((500 - msPerSlot) / 200) * 100));
      const fillColor = msPerSlot < 420 ? 'var(--accent)' : msPerSlot < 480 ? 'var(--warn)' : 'var(--danger)';
      document.getElementById('slotMeterFill').style.width = fillPct + '%';
      document.getElementById('slotMeterFill').style.background = fillColor;
      document.getElementById('slotQuality').textContent = quality;

      // Step 2: Epoch info
      setStatus('Fetching epoch info...', 'fetching');
      const epochInfo = await rpcCall(rpc, 'getEpochInfo');
      const slotIndex = epochInfo.slotIndex;
      const absSlot = epochInfo.absoluteSlot;
      const slotsInEpoch = epochInfo.slotsInEpoch;
      const epochStart = absSlot - slotIndex;
      const epochNum = epochInfo.epoch;
      const epochPct = Math.round((slotIndex / slotsInEpoch) * 100);
      const slotsLeft = slotsInEpoch - slotIndex;

      log(`Epoch ${epochNum} | ${slotIndex.toLocaleString()}/${slotsInEpoch.toLocaleString()} slots (${epochPct}%)`, 'ok');

      document.getElementById('currentSlot').textContent = absSlot.toLocaleString();
      document.getElementById('epochInfo').textContent = `Epoch ${epochNum}`;
      document.getElementById('epochFill').style.width = epochPct + '%';
      document.getElementById('epochPct').textContent = epochPct + '%';
      document.getElementById('epochSlots').textContent = slotsLeft.toLocaleString() + ' slots remaining';

      // Step 3: Leader schedule
      setStatus('Fetching leader schedule...', 'fetching');
      log(`Fetching leader schedule for epoch ${epochNum}...`);
      const schedule = await rpcCall(rpc, 'getLeaderSchedule');

      if (!schedule) throw new Error('getLeaderSchedule returned null');

      const myRelSlots = schedule[pubkey];

      if (!myRelSlots || myRelSlots.length === 0) {
        log(`No leader slots found for ${pubkey.slice(0,8)}...`, 'err');
        setStatus('Done ‚Äî no slots this epoch', 'done');
        document.getElementById('mainStats').classList.remove('hidden');
        document.getElementById('noSlotsCard').classList.remove('hidden');
        document.getElementById('checkBtn').disabled = false;
        return;
      }

      log(`Found ${myRelSlots.length} leader slots assigned this epoch`, 'ok');

      // Step 4: Find upcoming slots
      const currentAbs = slot2;
      const upcoming = myRelSlots
        .map(rel => epochStart + rel)
        .filter(abs => abs > currentAbs)
        .sort((a,b) => a-b);

      if (upcoming.length === 0) {
        log('All assigned slots have passed this epoch', 'err');
        setStatus('Done ‚Äî all slots passed', 'done');
        document.getElementById('mainStats').classList.remove('hidden');
        document.getElementById('noSlotsCard').classList.remove('hidden');
        document.getElementById('checkBtn').disabled = false;
        return;
      }

      nextSlotAbs = upcoming[0];
      const diff = nextSlotAbs - currentAbs;
      const totalSecs = Math.round(diff * msPerSlot / 1000);

      log(`Next slot: ${nextSlotAbs.toLocaleString()} (${diff.toLocaleString()} slots away, ~${Math.floor(totalSecs/60)}m ${totalSecs%60}s)`, 'ok');

      // Render upcoming slot pills
      const slotList = document.getElementById('slotList');
      slotList.innerHTML = '';
      upcoming.slice(0, 20).forEach((s, i) => {
        const pill = document.createElement('span');
        pill.className = 'slot-pill' + (i === 0 ? ' next' : '');
        pill.textContent = s.toLocaleString();
        slotList.appendChild(pill);
      });
      if (upcoming.length > 20) {
        const more = document.createElement('span');
        more.className = 'slot-pill';
        more.textContent = `+${upcoming.length - 20} more`;
        slotList.appendChild(more);
      }

      document.getElementById('nextSlotNum').textContent = nextSlotAbs.toLocaleString();
      document.getElementById('slotsRemaining').textContent = diff.toLocaleString();

      // Start live countdown
      startCountdown(diff, msPerSlot, t2);

      setStatus('Live ‚Äî countdown active', 'done');
      document.getElementById('mainStats').classList.remove('hidden');
      document.getElementById('nextSlotCard').classList.remove('hidden');

    } catch(e) {
      log('Error: ' + e.message, 'err');
      setStatus('Error ‚Äî check console', 'error');
      console.error(e);
    }

    document.getElementById('checkBtn').disabled = false;
  }

  function startCountdown(initialDiff, ms, startTime) {
    if (countdownInterval) clearInterval(countdownInterval);

    function tick() {
      const elapsed = Date.now() - startTime;
      const elapsedSlots = Math.floor(elapsed / ms);
      const remaining = Math.max(0, initialDiff - elapsedSlots);
      const remainingSecs = Math.max(0, Math.round(remaining * ms / 1000));

      const h = Math.floor(remainingSecs / 3600);
      const m = Math.floor((remainingSecs % 3600) / 60);
      const s = remainingSecs % 60;

      document.getElementById('ctHours').textContent = String(h).padStart(2,'0');
      document.getElementById('ctMins').textContent = String(m).padStart(2,'0');
      document.getElementById('ctSecs').textContent = String(s).padStart(2,'0');
      document.getElementById('slotsRemaining').textContent = remaining.toLocaleString();

      if (remainingSecs <= 0) {
        clearInterval(countdownInterval);
        setStatus('Leader slot reached! üéâ', 'done');
      }
    }

    tick();
    countdownInterval = setInterval(tick, 1000);
  }
</script>
</body>
</html>
